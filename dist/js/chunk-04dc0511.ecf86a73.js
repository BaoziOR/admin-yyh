(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-04dc0511","chunk-2d0f0f57","chunk-2d0d72e6"],{"765f":function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("Row",[o("Col",{attrs:{span:"4"}},[o("FormItem",{attrs:{prop:"shops["+e.index+"].provinceId",rules:{required:!0,message:"请选择省份"}}},[o("Select",{attrs:{placeholder:"选择省","label-in-value":!0},on:{"on-change":e.provinceChange},model:{value:e.provinceId,callback:function(t){e.provinceId=t},expression:"provinceId"}},e._l(e.provinceList,function(t,n){return o("Option",{key:n,attrs:{value:t.provinceCode}},[e._v(e._s(t.provinceName))])}),1)],1)],1),o("Col",{attrs:{span:"4"}},[o("FormItem",[o("Select",{attrs:{placeholder:"选择市","label-in-value":!0},on:{"on-change":e.cityChange},model:{value:e.cityId,callback:function(t){e.cityId=t},expression:"cityId"}},e._l(e.cityList,function(t,n){return o("Option",{key:n,attrs:{value:t.cityCode}},[e._v(e._s(t.cityName))])}),1)],1)],1),o("Col",{attrs:{span:"4"}},[o("FormItem",[o("Select",{attrs:{placeholder:"选择区","label-in-value":!0},on:{"on-change":e.areaChange},model:{value:e.areaId,callback:function(t){e.areaId=t},expression:"areaId"}},e._l(e.areaList,function(t,n){return o("Option",{key:n,attrs:{value:t.areaCode}},[e._v(e._s(t.areaName))])}),1)],1)],1),o("Col",{attrs:{span:"4"}},[o("FormItem",[o("Select",{attrs:{placeholder:"选择门店","label-in-value":!0},on:{"on-change":e.shopCodeChange},model:{value:e.shopCode,callback:function(t){e.shopCode=t},expression:"shopCode"}},e._l(e.shopList,function(t,n){return o("Option",{key:n,attrs:{value:t.shopId}},[e._v(e._s(t.shopName))])}),1)],1)],1),o("Col",{attrs:{span:"2"}},[o("Button",{attrs:{type:"dashed",long:"",icon:"ios-close"},on:{click:function(t){return e.handleRemove()}}})],1)],1)],1)},s=[],a=o("7f80"),i={props:{index:Number,shop:Object},data:function(){return{isInit:0,provinceList:[],cityList:[],areaList:[],shopList:[],provinceId:null,cityId:null,areaId:null,shopCode:null,provinceName:null,cityName:null,districtName:null}},methods:{loadProvinceList:function(e){var t=this;Object(a["h"])("/system/area/province/list").then(function(e){200==e.code?t.provinceList=e.data:t.$Message.error(e.msg)})},provinceChange:function(e,t){var o=this;this.cityList=[],this.areaList=[],this.shopList=[],this.cityId=null,this.areaId=null,this.shopCode=null,this.cityName=null,this.districtName=null,this.provinceName=e.label,this.$emit("sendProvinceId",this.provinceId,this.index),Object(a["d"])("/system/area/city/"+this.provinceId).then(function(e){200==e.code?(o.cityList=e.data,o.areaId=null):o.$Message.error(e.msg)}),this.loadShops()},cityChange:function(e,t){var o=this;this.areaList=[],this.shopList=[],this.areaId=null,this.shopCode=null,this.districtName=null,this.cityName=e?e.label:null,this.$emit("sendCityId",this.cityId,this.index),Object(a["d"])("/system/area/district/"+this.cityId).then(function(e){200==e.code?(o.areaList=e.data,t&&t()):o.$Message.error(e.msg)}),this.loadShops()},areaChange:function(e){this.shopList=[],this.shopCode=null,this.districtName=e?e.label:null,this.$emit("sendAreaId",this.areaId,this.index),this.loadShops()},shopCodeChange:function(e){this.isInit,e?this.$emit("sendShopCode",this.shopCode,e.label,this.index):this.$emit("sendShopCode",this.shopCode,null,this.index)},loadShops:function(){var e=this;Object(a["g"])("/system/sys-shop-info/list?pageNum=1&pageSize=2000",{province:this.provinceName,city:this.cityName,district:this.districtName}).then(function(t){200==t.code?e.shopList=t.data.records:e.$Message.error(t.msg)})},handleRemove:function(){this.$emit("handleRemove-event",this.index)},init:function(){var e=this;Object(a["g"])("/system/area/province/list").then(function(t){return 200==t.code?e.provinceList=t.data:e.$Message.error(t.msg),t}).then(function(t){return e.shop.provinceId&&(e.provinceId=e.shop.provinceId,e.provinceName=e.provinceList.find(function(t){return t.provinceCode==e.provinceId}).provinceName,e.loadShops()),t}).then(function(t){Object(a["d"])("/system/area/city/"+e.provinceId).then(function(t){return 200==t.code?(e.cityList=t.data,e.areaId=null,e.cityId=e.shop.cityId,e.shop.cityId&&(e.cityName=e.cityList.find(function(t){return t.cityCode==e.cityId}).cityName),e.loadShops()):e.$Message.error(t.msg),t}).then(function(t){e.shop.cityId&&Object(a["d"])("/system/area/district/"+e.cityId).then(function(t){200==t.code?(e.areaList=t.data,e.areaId=e.shop.areaId,e.shop.areaId&&(e.districtName=e.areaList.find(function(t){return t.areaCode==e.areaId}).areaName),e.shop.provinceId&&(e.shopCode=e.shop.shopCode,e.loadShops())):e.$Message.error(t.msg)})})})}},mounted:function(){null!=this.shop.provinceId&&1!=this.shop.provinceId&&(this.isInit=1),this.init()}},r=i,l=o("6691"),c=Object(l["a"])(r,n,s,!1,null,null,null);t["default"]=c.exports},"9f1e":function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("Form",{ref:"searchForm",attrs:{"label-width":80,model:e.searchForm,inline:""}},[o("FormItem",{attrs:{label:"券名称"}},[o("Input",{attrs:{placeholder:"券名称"},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),o("FormItem",[o("ButtonGroup",[o("Button",{staticClass:"submit",attrs:{type:"primary",icon:"ios-search"},on:{click:function(t){return e.search("searchForm")}}},[e._v("搜索")])],1)],1)],1),o("Table",{ref:"table",attrs:{border:"",columns:e.tableColumns,data:e.listData,sortable:"custom","highlight-row":!0},on:{"on-current-change":e.selectedTr}}),o("Row",{staticClass:"page",attrs:{type:"flex",justify:"end"}},[o("Page",{staticStyle:{float:"right"},attrs:{total:e.totalSize,"show-total":"","show-elevator":"",current:e.pageNum},on:{"on-change":e.changeCurrent,"update:current":function(t){e.pageNum=t}}})],1)],1)},s=[],a=o("7f80"),i={data:function(){return{TableLoading:!1,totalSize:0,pageNum:1,pageSize:10,listData:[],searchForm:{name:null,status:"1"},tableColumns:[{title:"券名称",key:"name"},{title:"活动开始时间",key:"startDate"},{title:"活动结束时间",key:"endDate"},{title:"兑换开始时间",key:"ChangeStartDate"},{title:"兑换结束时间",key:"ChangeEndDate"}]}},methods:{search:function(){this.TableLoading=!0,this.pageNum=1,this.loadData()},loadData:function(){var e=this;Object(a["g"])("/campagin/list?pageNum="+this.pageNum+"&pageSize="+this.pageSize,this.searchForm).then(function(t){e.TableLoading=!1,200==t.code?(e.totalSize=t.data.total,e.listData=t.data.records):e.msgErr(t.msg)})},selectedTr:function(e,t){this.$emit("seclectedTr-event",e.campId,e.name)},changeCurrent:function(e){this.searchForm.pageNum!=e&&(this.searchForm.pageNum=e,this.loadData())},init:function(){this.search()}},mounted:function(){this.init()}},r=i,l=o("6691"),c=Object(l["a"])(r,n,s,!1,null,null,null);t["default"]=c.exports},ded9:function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("Form",{ref:"form",attrs:{model:e.form,rules:e.formValite,"label-width":120}},[o("Row",[o("Col",{attrs:{span:"8"}},[o("FormItem",{attrs:{label:"选择优惠券",prop:"couponName",rules:{required:!0,message:"请选择优惠券"}}},[o("Input",{attrs:{placeholder:"点击按钮选择优惠券",disabled:""},model:{value:e.form.couponName,callback:function(t){e.$set(e.form,"couponName",t)},expression:"form.couponName"}},[o("Button",{attrs:{slot:"append"},on:{click:function(t){return e.handleChoose()}},slot:"append"},[e._v("选择")])],1)],1)],1)],1),o("FormItem",{attrs:{label:"BackCode集",prop:"backCode",rules:{required:!0,message:"必须按行输入BackCode集"}}},[o("Row",[o("Col",{attrs:{span:"8"}},[o("Input",{attrs:{type:"textarea",rows:10,placeholder:"BackCode集"},model:{value:e.form.backCode,callback:function(t){e.$set(e.form,"backCode",t)},expression:"form.backCode"}})],1)],1)],1),o("Row",[o("FormItem",{attrs:{label:"投放位置"}},[o("Row",[o("Col",{attrs:{span:"4"}},[o("FormItem",{attrs:{prop:"firstSite"}},[o("Select",{attrs:{placeholder:"选择渠道"},on:{"on-change":e.firstSiteChange},model:{value:e.form.firstSite,callback:function(t){e.$set(e.form,"firstSite",t)},expression:"form.firstSite"}},e._l(e.firstSiteList,function(t){return o("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1)],1),o("Col",{attrs:{span:"4"}},[o("FormItem",{attrs:{prop:"secondSite"}},[o("Select",{attrs:{placeholder:"选择位置"},model:{value:e.form.secondSite,callback:function(t){e.$set(e.form,"secondSite",t)},expression:"form.secondSite"}},e._l(e.secondSiteList,function(t){return o("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])}),1)],1)],1)],1)],1)],1),o("Row",[o("Col",{attrs:{span:"24"}},[o("FormItem",[o("p",{staticStyle:{color:"red"}},[e._v("*要优惠详情－0号位的barcode必须和优惠券保持一致。例如：用户扫农夫山泉300mlbarcode，扫出来的优惠券也必须是扫农夫山泉300ml优惠券")])])],1)],1),e._l(e.form.shops,function(t,n){return t.status?o("FormItem",{key:n,attrs:{label:"投放门店"}},[e.showStore?o("div",[o("storeView",{attrs:{index:t.index,shop:t},on:{sendProvinceId:e.sendProvinceId,sendCityId:e.sendCityId,sendAreaId:e.sendAreaId,sendShopCode:e.sendShopCode,"handleRemove-event":e.handleRemove}})],1):e._e()]):e._e()}),o("FormItem",{attrs:{label:" "}},[o("Button",{staticStyle:{width:"100px"},attrs:{type:"dashed",long:"",icon:"md-add"},on:{click:e.handleAdd}})],1),o("FormItem",{attrs:{label:"曝光量",prop:"showNum"}},[o("Row",[o("Col",{attrs:{span:"4"}},[o("Input",{attrs:{placeholder:"曝光量",type:"text"},model:{value:e.form.showNum,callback:function(t){e.$set(e.form,"showNum",t)},expression:"form.showNum"}},[o("span",{attrs:{slot:"append"},slot:"append"},[e._v("次")])])],1)],1)],1),o("FormItem",{attrs:{label:"投放量",prop:"num"}},[o("Row",[o("Col",{attrs:{span:"4"}},[o("Input",{attrs:{placeholder:"投放量",type:"text"},model:{value:e.form.num,callback:function(t){e.$set(e.form,"num",t)},expression:"form.num"}},[o("span",{attrs:{slot:"append"},slot:"append"},[e._v("张")])])],1)],1)],1),o("FormItem",{attrs:{label:"优惠力度",prop:"discounts"}},[o("Row",[o("Col",{attrs:{span:"4"}},[o("Input",{attrs:{placeholder:"优惠力度",type:"text"},model:{value:e.form.discounts,callback:function(t){e.$set(e.form,"discounts",t)},expression:"form.discounts"}},[o("span",{attrs:{slot:"append"},slot:"append"},[e._v("%")])])],1)],1)],1),o("Row",[o("Col",{attrs:{span:"12"}},[o("FormItem",{attrs:{label:"时间",prop:"startDate",rules:{required:!0,message:"请选择日期"}}},[o("DatePicker",{staticClass:"date-range",staticStyle:{width:"450px"},attrs:{value:e.datetimerange,type:"datetimerange",placement:"bottom-end",placeholder:"请选择日期"},on:{"on-change":e.datetimechange}})],1)],1)],1),o("FormItem",{attrs:{label:" "}},[o("Button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("form")}}},[e._v("提交")]),o("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.handleReset("form")}}},[e._v("重置")])],1)],2),o("Modal",{attrs:{title:"选择优惠券",width:"800px"},on:{"footer-hide":!1},model:{value:e.couponModalShow,callback:function(t){e.couponModalShow=t},expression:"couponModalShow"}},[o("chooseCouponListView",{on:{"seclectedTr-event":e.selectedTrCallBack}})],1)],1)},s=[],a=o("7f80"),i=o("765f"),r=o("9f1e"),l={components:{storeView:i["default"],chooseCouponListView:r["default"]},props:{id:Number},data:function(){var e=function(e,t,o){var n=/^\d+(?=\.{0,1}\d+$|$)/;n.test(t)?o():o(new Error("请输入大于等于0的正数"))},t=function(e,t,o){var n=/^([1-9][0-9]*)$/;n.test(t)?o():o(new Error("请输入大于0的正整数"))};return{index:0,showStore:!1,datetimerange:[],form:{id:null,couponId:null,couponName:null,backCode:null,firstSite:null,secondSite:null,num:null,showNum:null,discounts:null,startDate:null,endDate:null,shops:[{provinceId:null,cityId:null,areaId:null,shopCode:null,shopName:null,index:0,status:1}]},formValite:{firstSite:[{required:!0,message:"请选择投放渠道"}],secondSite:[{required:!0,message:"请选择投放位置"}],num:[{required:!0,validator:t,trigger:"blur"}],showNum:[{required:!0,validator:t,trigger:"blur"}],discounts:[{required:!0,validator:e,trigger:"blur"}]},firstSiteList:[{label:"要优惠详情页",value:"1"},{label:"要优惠领券成功页",value:"2"},{label:"团员拼团成功页",value:"3"},{label:"团员拼团失败页",value:"4"},{label:"团长拼团成功页",value:"5"},{label:"团长拼团失败页",value:"6"},{label:"领优惠领券成功页",value:"7"}],secondSiteList:[],shoplist:[],couponModalShow:!1}},methods:{loadForm:function(e){var t=this;if(this.showStore=!0,null!==e&&void 0!==e&&""!==e){this.form.shops=[],Object(a["g"])("/couponrecommend/selectById?id="+e).then(function(o){if(200==o.code){var n=o.data;t.form.id=e,t.form.couponId=n.campId,t.form.couponName=n.campName,t.form.firstSite=n.distributeChannel+"",t.firstSiteChange(),t.form.secondSite=n.distributeLocation+"","1"!==t.form.firstSite&&void 0!==t.form.firstSite&&t.secondSiteList.splice(0,1),t.form.num=n.distributeCount,t.form.showNum=n.exposureCount,t.form.discounts=n.promotion,t.form.startDate=n.distributeStartDate,t.form.endDate=n.distributeEndDate,t.datetimerange.push(t.form.startDate),t.datetimerange.push(t.form.endDate)}else t.$Message.error(o.msg)}),Object(a["c"])("/couponrecommend/barcodeRelation/list/"+e).then(function(e){if(200==e.code){var o=[];e.data.forEach(function(e){o.push(e.barcode)}),t.form.backCode=o.toString().replace(/[,]/g,"\r\n")}else t.$Message.error(e.msg)});var o={};o.id=e,Object(a["g"])("/couponrecommend/shopRelation/listCodeShop",o).then(function(e){if(200==e.code){var o=0;t.form.shops=[],e.data.forEach(function(e){var n={};n.provinceId=e.province,n.cityId=e.city,n.areaId=e.district,n.shopCode=e.shopCode,n.shopName=e.shopName,n.index=o,n.status=1,t.form.shops.push(n),o++})}else t.$Message.error(e.msg)})}},handleSubmit:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var o={};o.id=t.form.id,o.campId=t.form.couponId,o.barcodeString=t.getSplitString(t.form.backCode),o.distributeChannel=t.form.firstSite,o.distributeLocation=t.form.secondSite,o.exposureCount=t.form.num,o.distributeCount=t.form.showNum,o.promotion=t.form.discounts,o.distributeStartDate=t.form.startDate,o.distributeEndDate=t.form.endDate;var n=t.form.shops.filter(function(e,t,o){return 1==e.status});if(o.shopVOList=n.map(function(e){var t={};return t.province=e.provinceId,t.city=e.cityId,t.district=e.areaId,t.shopCode=e.shopCode,t.shopName=e.shopName,t}),null!==t.form.id&&void 0!==t.form.id&&""!==t.form.id)return console.log("-------------edit------------"),void Object(a["g"])("/couponrecommend/edit",o).then(function(e){200==e.code?t.$emit("closeFormModal-event"):t.$Message.error(e.msg)});Object(a["g"])("/couponrecommend/add",o).then(function(e){console.log("-------------add------------"),200==e.code?t.$emit("closeFormModal-event"):t.$Message.error(e.msg)})}})},handleReset:function(e){this.$refs[e].resetFields(),this.form.startDate=null,this.form.endDate=null},handleChoose:function(){this.couponModalShow=!0},handleAdd:function(){this.index++,this.form.shops.push({provinceId:null,cityId:null,areaId:null,shopCode:null,shopName:null,index:this.index,status:1})},handleRemove:function(e){0!=e?this.form.shops[e].status=0:this.msgErr("必须保留一条")},firstSiteChange:function(){this.secondSiteList=[{label:"0号位",value:"0"},{label:"1号位",value:"1"},{label:"2号位",value:"2"},{label:"3号位",value:"3"}],"1"!=this.form.firstSite&&this.secondSiteList.splice(0,1)},selectedTrCallBack:function(e,t){this.form.couponId=e,this.form.couponName=t,this.couponModalShow=!1},sendProvinceId:function(e,t){this.form.shops[t].provinceId=e},sendCityId:function(e,t){this.form.shops[t].cityId=e},sendAreaId:function(e,t){this.form.shops[t].areaId=e},sendShopCode:function(e,t,o){this.form.shops[o].shopCode=e,this.form.shops[o].shopName=t},datetimechange:function(e){this.form.startDate=e[0],this.form.endDate=e[1],console.log(this.form)},modalClose:function(){this.showStore=!1,this.datetimerange=[],this.form.shops=null,this.form.id=null,this.form={id:null,couponId:null,couponName:null,backCode:null,firstSite:null,secondSite:null,num:null,showNum:null,discounts:null,startDate:null,endDate:null,shops:[{provinceId:null,cityId:null,areaId:null,shopCode:null,shopName:null,index:0,status:1}]}},msgErr:function(e){this.$Message.error({content:e,duration:3})},init:function(){},getSplitString:function(e){if(!e||0==e.length)return"";for(var t=e.split(","),o="",n=0;n<t.length;n++)for(var s=t[n].split(/\s+/),a=0;a<s.length;a++){var i=s[a].replace(/^\s+|\s+$/g,"");""!=i&&(o+=i+",")}return o}},mounted:function(){this.init()}},c=l,d=o("6691"),u=Object(d["a"])(c,n,s,!1,null,null,null);t["default"]=u.exports}}]);