(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-692c554d"],{"0ccb":function(e,t,a){},1408:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"reward-u-edit"},[a("h2",{staticClass:"header"},[e._v("任务中心 > 任务模板 > 赏“U”> 新增")]),a("Row",{attrs:{type:"flex",justify:"start"}},[a("Button",{attrs:{type:"dashed",icon:"md-arrow-round-back"},on:{click:e.goback}},[e._v("返回列表")])],1),a("br"),a("div",[a("Form",{ref:"form",attrs:{"label-position":"right",model:e.formData,rules:e.ruleValidate,"label-width":100}},[a("row",{staticClass:"task-info"},[a("h3",[e._v("任务信息")]),a("FormItem",{attrs:{label:"任务名称：",prop:"name",rules:{required:!0,message:"请输入任务名称"}}},[a("Row",[a("Col",{attrs:{span:"10"}},[a("Input",{staticStyle:{width:"90%"},attrs:{maxlength:20,placeholder:"请输入",clearable:""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1)],1)],1),a("FormItem",{attrs:{label:"任务时间：",prop:"startTime",rules:{required:!0,message:"请选择时间"}}},[a("Row",[a("Col",{attrs:{span:"10"}},[a("DatePicker",{staticClass:"date-range",staticStyle:{width:"90%"},attrs:{type:"daterange",format:"yyyy-MM-dd",placeholder:"请选择时间",options:e.m_dateOptions,value:e.formData.daterange},on:{"on-change":e.changeTaskDate}})],1)],1)],1),a("FormItem",{attrs:{label:"任务规则："}},[a("Row",[a("Col",{attrs:{span:"10"}},[a("Tooltip",{attrs:{trigger:"focus",title:"提醒",content:"最多500个汉字",placement:"right"}},[a("Input",{staticStyle:{width:"400px"},attrs:{type:"textarea",autosize:{minRows:4,maxRows:8},placeholder:"请输入500个字符以内",maxlength:500},model:{value:e.formData.ruleDescribe,callback:function(t){e.$set(e.formData,"ruleDescribe",t)},expression:"formData.ruleDescribe"}})],1)],1)],1)],1)],1),a("row",{staticClass:"task-reward-Rules"},[a("h3",[e._v("奖励规则")]),a("FormItem",{attrs:{label:"奖励规则：",prop:"ruleInfoList",rules:{required:!0,validator:e.validateRewardRules}}},[a("Button",{attrs:{type:"primary",icon:"md-add-circle",size:"small"},on:{click:e.addRewardRules}},[e._v("新增")])],1),e._l(e.formData.ruleInfoList,function(t,r){return a("RewardRulesItem",{key:r,attrs:{item:t,index:r},on:{del:e.del}})})],2)],1)],1),a("div",{staticClass:"demo-drawer-footer"},[a("Button",{staticStyle:{"margin-right":"8px"},attrs:{type:"primary"},on:{click:function(t){return e.handleSubmit("form")}}},[e._v("保存")]),a("Button",{staticStyle:{"margin-right":"8px"},on:{click:e.closeDialog}},[e._v("取消")])],1)],1)},n=[],i=a("3add"),s=a.n(i),o=a("6797"),l=a("872c"),c=a("1e85");function d(e,t,a,r,n,i,s){try{var o=e[i](s),l=o.value}catch(c){return void a(c)}o.done?t(l):Promise.resolve(l).then(r,n)}function m(e){return function(){var t=this,a=arguments;return new Promise(function(r,n){var i=e.apply(t,a);function s(e){d(i,r,n,s,o,"next",e)}function o(e){d(i,r,n,s,o,"throw",e)}s(void 0)})}}var u={name:"reward-u-edit",mixins:[l["a"]],components:{RewardRulesItem:c["default"]},props:{showDeduction:{type:Boolean,default:!0}},data:function(){return{isShow:!1,title:"扣款信息",styles:{height:"calc(100% - 55px)",overflow:"auto",paddingBottom:"53px",position:"static"},data:{},formData:{id:"",name:"",startTime:"",endTime:"",daterange:[],ruleDescribe:"",ruleInfoList:[{merchantType:0,merchantId:"",merhcantName:"",brandId:"",brandName:"",anticipatedUbay:"",templateId:"",templateName:"",endTime:"",receivedNum:"",receiveAwardUbay:"",useAwardUbay:"",shareReceiveAwardUbay:"",shareUseAwardUbay:""}]},ruleValidate:{}}},mounted:function(){var e=this.$store.state.missionCenter,t=e.type,a=e.data;"edit"==t&&(this.formData=a,console.log("this.formData",a))},beforeDestroy:function(){this.$store.state.missionCenter.data={}},methods:{goback:function(){console.log("reward-u"),this.$store.dispatch("missionCenter/changeCompName","reward-u")},del:function(e){console.log("delrules:",e),this.formData.ruleInfoList.splice(e,1)},changeTaskDate:function(e){console.log("1form.daterange",this.formData.daterange),this.formData.daterange=e,console.log("2form.daterange",this.formData.daterange),this.formData.startTime=e[0],this.formData.endTime=e[1]},validateRewardRules:function(e,t,a){if(console.log("validateRewardRules",e,t),!t.length)return a("请填写奖励规则");a()},addRewardRules:function(){this.formData.ruleInfoList.push({merchantType:0,merchantId:"",merhcantName:"",brandId:"",brandName:"",anticipatedUbay:"",templateId:"",templateName:"",endTime:"",receivedNum:"",receiveAwardUbay:"",useAwardUbay:"",shareReceiveAwardUbay:"",shareUseAwardUbay:""})},validateMoney:function(e,t,a){if(t+="",t=t.trim(),""==t)return a("金额不能为空");if(!t||"0"==t||"0.0"==t||"0.00"==t)return a(new Error("兑换的金额不能为0"));var r=Number(t);if(isNaN(r))return a(new Error("请输入数字"));if(!(r>0&&r<=99999.99))return a(new Error("请输入[0.01—99999.99]之间的数"));var n=/^(0|[1-9]\d*)(\s|$|\.\d{1,2}\b)/;if(!n.test(t))return a(new Error("请输入大于等于0的金额，小数点最多包含两位小数"));a()},closeDialog:function(){console.log("closeDialog"),this.goback()},handleSubmit:function(e){var t=this;this.$refs[e].validate(function(){var e=m(s.a.mark(function e(a){var r,n,i;return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!a){e.next=12;break}return t.$Message.success("数据验证成功!"),r=JSON.parse(JSON.stringify(t.formData)),console.log("add save:",r),n="",n=r.id?"/merchant/assignment/edit":"/merchant/assignment/add",e.next=8,Object(o["j"])(n,r);case 8:i=e.sent,200==i.code?(t.msgOk("保存成功"),t.goback()):t.msgErr(i.msg),e.next=13;break;case 12:t.$Message.error("数据验证失败！");case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())},msgOk:function(e){this.$Message.info({content:e,duration:3})},msgErr:function(e){this.$Message.error({content:e,duration:3})}}},p=u,h=(a("2a0b"),a("6691")),b=Object(h["a"])(p,r,n,!1,null,"d532a174",null);t["default"]=b.exports},"1e85":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.showBusinessList?a("BusinessList",{attrs:{showBusinessList:e.showBusinessList},on:{"update:showBusinessList":function(t){e.showBusinessList=t},"update:show-business-list":function(t){e.showBusinessList=t},"seclectedTr-event":e.selectedTrCallBack}}):e._e(),e.showBrandList?a("BrandList",{attrs:{showBrandList:e.showBrandList},on:{"update:showBrandList":function(t){e.showBrandList=t},"update:show-brand-list":function(t){e.showBrandList=t},"seclectedTr-event":e.selectedTrCallBack}}):e._e(),e.showCouponList?a("CouponList",{attrs:{showCouponList:e.showCouponList},on:{"update:showCouponList":function(t){e.showCouponList=t},"update:show-coupon-list":function(t){e.showCouponList=t},"seclectedTr-event":e.selectedCouponItem}}):e._e(),a("Alert",[a("FormItem",{attrs:{label:"商户类型：",prop:"ruleInfoList."+e.index+".merchantType"}},[a("Row",{staticClass:"code-row-bg",attrs:{type:"flex",justify:"space-between"}},[a("Col",{attrs:{span:"4"}},[a("RadioGroup",{model:{value:e.item.merchantType,callback:function(t){e.$set(e.item,"merchantType",t)},expression:"item.merchantType"}},e._l(e.businessTypeList,function(t){return a("Radio",{key:t.value,attrs:{label:t.value}},[a("span",[e._v(e._s(t.label))])])}),1)],1),a("Col",{attrs:{span:"2"}},[a("Button",{attrs:{type:"error",icon:"md-trash",size:"small"},on:{click:function(t){return e.compatible_delInfo(e.index,e.item)}}},[e._v("删除")])],1)],1)],1),a("FormItem",{attrs:{label:"商户名称：",prop:"ruleInfoList."+e.index+"."+(e.item.merchantType?"brandName":"merhcantName"),rules:{required:!0,validator:e.validateBusinessName}}},[a("Row",[a("Col",{attrs:{span:"10"}},[a("Input",{staticStyle:{width:"230px"},attrs:{placeholder:"点击按钮选择"+e.businessTypeLabel,disabled:""},model:{value:e.item[e.item.merchantType?"brandName":"merhcantName"],callback:function(t){e.$set(e.item,e.item.merchantType?"brandName":"merhcantName",t)},expression:"item[`${item.merchantType?'brandName':'merhcantName'}`]"}},[a("Button",{attrs:{slot:"append"},on:{click:e.handleChoose},slot:"append"},[e._v("选择")])],1)],1)],1)],1),a("Row",{staticClass:"box",staticStyle:{"margin-bottom":"20px"}},[a("Table",{attrs:{size:"small",border:"",width:"600px",columns:e.dynamicColumns,data:e.tableData},scopedSlots:e._u([{key:"operate",fn:function(t){var r=t.row;return[a("Button",{staticStyle:{color:"#2db7f5"},attrs:{size:"small",icon:"ios-trash-outline"},on:{click:function(t){return e.remove(r)}}},[e._v("移除")])]}}])})],1),a("FormItem",{attrs:{label:"消耗U贝：",prop:"ruleInfoList."+e.index+".anticipatedUbay",rules:{required:!0,validator:e.validateUbay}}},[a("Row",[a("Col",{attrs:{span:"10"}},[a("Input",{staticStyle:{width:"230px"},attrs:{placeholder:"请输入需要消耗U贝的数量",clearable:""},model:{value:e.item.anticipatedUbay,callback:function(t){e.$set(e.item,"anticipatedUbay",t)},expression:"item.anticipatedUbay"}})],1)],1)],1),a("FormItem",{attrs:{label:"优惠券：",prop:"ruleInfoList."+e.index+".templateName}",rules:{required:!0,validator:e.validateEmpty("请选择优惠券")}}},[a("Row",[a("Col",{attrs:{span:"10"}},[a("Input",{staticStyle:{width:"230px"},attrs:{placeholder:"点击按钮选择优惠券",disabled:""},model:{value:e.item.templateName,callback:function(t){e.$set(e.item,"templateName",t)},expression:"item.templateName"}},[a("Button",{attrs:{slot:"append"},on:{click:e.handleChooseCoupon},slot:"append"},[e._v("选择")])],1)],1)],1)],1),a("FormItem",{attrs:{label:"截止时间：",prop:"ruleInfoList."+e.index+".endTime",rules:{required:!0,validator:e.validateEmpty("请选择时间"),trigger:"blur"}}},[a("Row",[a("Col",{attrs:{span:"6"}},[a("DatePicker",{staticStyle:{width:"230px"},attrs:{type:"date",placeholder:"请选择时间",value:e.item.endTime},on:{"on-change":e.changeEndTime}})],1),a("Col",{attrs:{span:"18"}},[e._v("\n          领取量低于\n          "),a("Input",{staticStyle:{width:"100px"},attrs:{placeholder:"请填写数量",clearable:""},model:{value:e.item.receivedNum,callback:function(t){e.$set(e.item,"receivedNum",t)},expression:"item.receivedNum"}}),e._v("任务自动终止\n        ")],1)],1)],1),a("Divider"),a("FormItem",{attrs:{"label-width":0,prop:"ruleInfoList."+e.index+".receiveAwardUbay",rules:{required:!0,validator:e.validateUbay}}},[e._v("\n      每领取一张券，奖励领取者\n      "),a("Input",{staticStyle:{display:"inline-block",width:"100px"},attrs:{placeholder:"请输入数字",clearable:""},model:{value:e.item.receiveAwardUbay,callback:function(t){e.$set(e.item,"receiveAwardUbay",t)},expression:"item.receiveAwardUbay"}}),e._v(" U贝  通过分享领取不享受该奖励\n    ")],1),a("FormItem",{attrs:{"label-width":0,prop:"ruleInfoList."+e.index+".useAwardUbay",rules:{required:!0,validator:e.validateUbay}}},[e._v("\n      每核销一张券，奖励领取者\n      "),a("Input",{staticStyle:{display:"inline-block",width:"100px"},attrs:{placeholder:"请输入数字",clearable:""},model:{value:e.item.useAwardUbay,callback:function(t){e.$set(e.item,"useAwardUbay",t)},expression:"item.useAwardUbay"}}),e._v(" U贝   通过分享领取核销，不享受该奖励\n    ")],1),a("Divider"),a("FormItem",{attrs:{"label-width":0,prop:"ruleInfoList."+e.index+".shareReceiveAwardUbay",rules:{required:!0,validator:e.validateUbay}}},[e._v("\n      分享券被领取，奖励分享者\n      "),a("Input",{staticStyle:{display:"inline-block",width:"100px"},attrs:{placeholder:"请输入数字",clearable:""},model:{value:e.item.shareReceiveAwardUbay,callback:function(t){e.$set(e.item,"shareReceiveAwardUbay",t)},expression:"item.shareReceiveAwardUbay"}}),e._v(" U贝\n    ")],1),a("FormItem",{attrs:{"label-width":0,prop:"ruleInfoList."+e.index+".shareUseAwardUbay",rules:{required:!0,validator:e.validateUbay}}},[e._v("\n      分享券被核销，奖励分享者\n      "),a("Input",{staticStyle:{display:"inline-block",width:"100px"},attrs:{placeholder:"请输入数字",clearable:""},model:{value:e.item.shareUseAwardUbay,callback:function(t){e.$set(e.item,"shareUseAwardUbay",t)},expression:"item.shareUseAwardUbay"}}),e._v(" U贝\n    ")],1)],1)],1)},n=[],i=a("511f"),s=a("fae5"),o=a("0579");function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var c={name:"rules-item",components:{BusinessList:i["default"],BrandList:s["default"],CouponList:o["default"]},props:{index:{type:Number,default:0},item:{type:Object,default:function(){return{merchantType:0,merchantId:"",merhcantName:"",brandId:"",brandName:"",anticipatedUbay:"",templateId:"",templateName:"",endTime:"",receivedNum:"",receiveAwardUbay:"",useAwardUbay:"",shareReceiveAwardUbay:"",shareUseAwardUbay:""}}}},computed:{dynamicColumns:function(){return 0==this.item.merchantType?this.columns1:this.columns2}},watch:l({},"item.merchantType",function(){var e=this,t=this.item.merchantType;this.businessTypeList.some(function(a){var r=a.value==t;return r&&(e.businessTypeLabel=a.label),r}),console.log("watch-----------,",t,this.$parent)}),data:function(){return{showBusinessList:!1,showBrandList:!1,showCouponList:!1,businessTypeLabel:"商户",businessTypeList:[{value:0,label:"商户"},{value:1,label:"品牌"}],merchantTypeOption:[{value:0,label:"本地商户（单店）"},{value:1,label:"本地商户（多店）"}],payTypeList:[{id:"1",name:"现金"},{id:"2",name:"微信"},{id:"3",name:"支付宝"},{id:"4",name:"银行卡"}],tableData:[],columns1:[{title:"商户编号",align:"center",width:200,key:"merchantId"},{title:"商户名称",align:"center",width:200,key:"name"},{title:"地址",align:"center",minWidth:300,key:"address"},{title:"操作",align:"center",width:140,key:"action",slot:"operate"}],columns2:[{title:"品牌编号",align:"center",width:200,key:"id"},{title:"品牌名称",align:"center",width:200,key:"name"},{title:"关联店铺数",align:"center",minWidth:300,key:"address"},{title:"操作",align:"center",width:140,key:"action",slot:"operate"}]}},methods:{changeEndTime:function(e){this.item.endTime=e},validateUbay:function(e,t,a){var r=/^([0-9][0-9]*)$/;r.test(t)?a():a(new Error("请输入大于等于0的正整数"))},remove:function(){var e=this,t=["brandId","merchantId","brandName","merhcantName"];t.forEach(function(t){e.item[t]=""}),this.tableData=[]},selectedTrCallBack:function(e){console.log(this.item.merchantType,"selectedTrCallBack----",e);var t=this.item.merchantType?"brandId":"merchantId",a=this.item.merchantType?"brandName":"merhcantName";this.item[t]=e.id,this.item[a]=e.name,this.tableData=[e.row],console.log(t,a)},selectedCouponItem:function(e){console.log("selectedCouponItem----",e);var t=e.id,a=e.name;this.item.templateId=t,this.item.templateName=a,console.log(t,a)},handleChoose:function(){0==this.item.merchantType?this.showBusinessList=!0:this.showBrandList=!0},handleChooseCoupon:function(){this.showCouponList=!0},validateBusinessName:function(e,t,a){if(t+="",t=t.trim(),""==t)return a("请选择".concat(this.businessTypeLabel));a()},compatible_delInfo:function(e,t){this.$emit("del",e)},validateEmpty:function(e){return function(t,a,r){if(console.log(1111111,t,a),a+="",a=a.trim(),""==a)return r(e);r()}}}},d=c,m=a("6691"),u=Object(m["a"])(d,r,n,!1,null,null,null);t["default"]=u.exports},"2a0b":function(e,t,a){"use strict";var r=a("0ccb"),n=a.n(r);n.a}}]);