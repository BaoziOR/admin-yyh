(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-06b5871b","chunk-2d0d43b9","chunk-2d0bdcfd"],{"2e1e":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Modal",{attrs:{width:"800",title:"参与活动优惠券",closable:!1,"mask-closable":!1,"footer-hide":""},model:{value:t.viewDialogVisible,callback:function(e){t.viewDialogVisible=e},expression:"viewDialogVisible"}},[a("div",[a("Tabs",{attrs:{type:"card"}},[a("TabPane",{attrs:{label:"商超"}},[a("div",[a("Card",{staticStyle:{"margin-bottom":"2px"},attrs:{bordered:!1}},[a("Form",{ref:"volumeForm",attrs:{"label-position":"right","label-width":80,model:t.volumeForm,inline:""}},[a("FormItem",{staticStyle:{width:"25%"},attrs:{label:"商户名称",span:"24"}},[a("Input",{attrs:{placeholder:" 请填写商户名称",maxlength:20},model:{value:t.volumeForm.name,callback:function(e){t.$set(t.volumeForm,"name",e)},expression:"volumeForm.name"}})],1),a("FormItem",{staticStyle:{width:"23%"},attrs:{label:"省/市",span:"24"}},[a("Cascader",{attrs:{data:t.addressData,"load-data":t.addressLoad},model:{value:t.addressValue,callback:function(e){t.addressValue=e},expression:"addressValue"}})],1),a("FormItem",{staticStyle:{width:"23%"},attrs:{label:"优惠券名称",span:"24"}},[a("Input",{attrs:{placeholder:"请填写优惠券名称",maxlength:20},model:{value:t.volumeForm.name,callback:function(e){t.$set(t.volumeForm,"name",e)},expression:"volumeForm.name"}})],1),a("FormItem",{staticStyle:{width:"23%"},attrs:{span:"24","label-width":1}},[a("Button",{staticClass:"submit",staticStyle:{"margin-right":"5px"},attrs:{type:"primary",icon:"ios-search"},on:{click:function(e){return t.search(1)}}},[t._v("搜索")]),a("Button",{attrs:{icon:"md-refresh"},on:{click:t.reset}},[t._v("重置")])],1)],1)],1),a("Card",[a("Row",[a("RadioGroup",{staticStyle:{width:"100%"},on:{"on-change":function(e){return t.selectBusiness(1)}},model:{value:t.selectIndex1,callback:function(e){t.selectIndex1=e},expression:"selectIndex1"}},[a("Table",{ref:"table",attrs:{loading:t.TableLoading1,border:"",columns:t.tableColumns,data:t.listData1,sortable:"custom"},on:{"on-selection-change":t.handleSelect},scopedSlots:t._u([{key:"action",fn:function(t){t.row;var e=t.index;return[a("Radio",{attrs:{label:e}},[a("span")])]}},{key:"address",fn:function(e){var o=e.row;e.index;return[a("div",[t._v(t._s(o.province+"/"+o.city))])]}},{key:"timer",fn:function(e){var o=e.row;e.index;return[a("div",[t._v(t._s(o.startDate+"/"+o.endDate))])]}}])})],1)],1),a("Row",{staticClass:"page",attrs:{type:"flex",justify:"end"}},[a("Page",{staticStyle:{float:"right"},attrs:{total:t.totalSize1,"show-total":"","show-elevator":"",current:t.current1},on:{"on-change":t.changeCurrent1,"update:current":function(e){t.current1=e}}})],1)],1)],1)]),a("TabPane",{attrs:{label:"商户"}},[a("div",[a("Card",{staticStyle:{"margin-bottom":"2px"},attrs:{bordered:!1}},[a("Form",{ref:"volumeForm",attrs:{"label-position":"right","label-width":80,model:t.volumeForm,inline:""}},[a("FormItem",{staticStyle:{width:"25%"},attrs:{label:"商户名称",span:"24"}},[a("Input",{attrs:{placeholder:" 请填写商户名称",maxlength:20},model:{value:t.volumeForm.name,callback:function(e){t.$set(t.volumeForm,"name",e)},expression:"volumeForm.name"}})],1),a("FormItem",{staticStyle:{width:"23%"},attrs:{label:"省/市",span:"24"}},[a("Cascader",{attrs:{data:t.addressData,"load-data":t.addressLoad},model:{value:t.addressValue,callback:function(e){t.addressValue=e},expression:"addressValue"}})],1),a("FormItem",{staticStyle:{width:"23%"},attrs:{label:"优惠券名称",span:"24"}},[a("Input",{attrs:{placeholder:"请填写优惠券名称",maxlength:20},model:{value:t.volumeForm.name,callback:function(e){t.$set(t.volumeForm,"name",e)},expression:"volumeForm.name"}})],1),a("FormItem",{staticStyle:{width:"23%"},attrs:{span:"24","label-width":1}},[a("Button",{staticClass:"submit",staticStyle:{"margin-right":"5px"},attrs:{type:"primary",icon:"ios-search"},on:{click:function(e){return t.search(2)}}},[t._v("搜索")]),a("Button",{attrs:{icon:"md-refresh"},on:{click:t.reset}},[t._v("重置")])],1)],1)],1),a("Card",[a("Row",[a("RadioGroup",{staticStyle:{width:"100%"},on:{"on-change":function(e){return t.selectBusiness(2)}},model:{value:t.selectIndex2,callback:function(e){t.selectIndex2=e},expression:"selectIndex2"}},[a("Table",{ref:"table",attrs:{loading:t.TableLoading2,border:"",columns:t.tableColumns,data:t.listData2,sortable:"custom"},on:{"on-selection-change":t.handleSelect},scopedSlots:t._u([{key:"action",fn:function(t){t.row;var e=t.index;return[a("Radio",{attrs:{label:e}},[a("span")])]}},{key:"address",fn:function(e){var o=e.row;e.index;return[a("div",[t._v(t._s(o.province+"/"+o.city))])]}},{key:"timer",fn:function(e){var o=e.row;e.index;return[a("div",[t._v(t._s(o.useStartTime+"/"+o.useEndTime))])]}}])})],1)],1),a("Row",{staticClass:"page",attrs:{type:"flex",justify:"end"}},[a("Page",{staticStyle:{float:"right"},attrs:{total:t.totalSize2,"show-total":"","show-elevator":"",current:t.current2},on:{"on-change":t.changeCurrent2,"update:current":function(e){t.current2=e}}})],1)],1)],1)])],1)],1),a("div",{staticStyle:{"text-align":"center",margin:"20px 0"}},[a("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:t.volumeSave}},[t._v("保存")]),a("Button",{staticStyle:{"margin-left":"8px"},on:{click:t.volumeClose}},[t._v("关闭")])],1)])},i=[],n=a("7f80"),s={name:"volume-modal",props:{viewDialogVisible:{type:Boolean,default:!1}},data:function(){return{TableLoading1:"",TableLoading2:"",volumeForm:{name:"",current2:1,current1:1},volumeObj:{},addressData:[],totalSize1:0,totalSize2:0,current1:1,current2:1,addressValue:[],selectIndex1:"",selectIndex2:"",tableColumns:[{title:"操作",width:80,align:"center",slot:"action",fixed:"left"},{title:"商户名称",width:220,key:"merchantName"},{title:"省/市",minWidth:200,slot:"address"},{title:"优惠券名称",width:200,align:"center",key:"title"},{title:"有效期",minWidth:200,slot:"timer"}],listData1:[],listData2:[],selectDataList:[]}},methods:{search:function(t){switch(t){case 1:this.loadTableData1();break;case 2:this.loadTableData2();break}},resetRow:function(t){this.volumeForm.merchantName="",this.volumeForm.couponName="",this.addressValue=[],this.volumeObj=t,this.TableLoading=!1,this.loadTableData1(t),this.loadTableData2(t)},reset:function(){},getProvinceList:function(t){var e=this;Object(n["g"])("/system/area/province/list",{}).then(function(t){"200"===t.code?(console.log(t),e.addressData=t.data||[],e.addressData.length&&e.addressData.forEach(function(t){t.value=t.provinceCode,t.label=t.shortName,t.children=[],t.loading=!1})):e.$Message.error("获取数据失败")})},addressLoad:function(t,e){var a=this;t.loading=!0,Object(n["d"])("/system/area/city/"+t.provinceCode).then(function(o){"200"===o.code?(t.children=o.data||[],t.loading=!1,t.children.length&&t.children.forEach(function(t){t.label=t.shortName,t.value=t.cityCode}),e()):(a.$Message.error("获取数据失败"),t.loading=!1,e())})},loadTableData1:function(){var t=this,e=this,a=this.volumeObj;this.totalSize1=0,this.listData1=[],this.TableLoading1=!0,this.selectIndex1="";var o={page:this.volumeForm.current1,size:10,cityCode:this.addressValue[1]||"",couponName:this.volumeForm.couponName,merchantName:this.volumeForm.merchantName,provinceCode:this.addressValue[0]||""};Object(n["g"])("/coupon/superMarket/list?pageNum=".concat(this.current1,"&pageSize=10"),o).then(function(o){t.TableLoading1=!1,"200"===o.code?(t.totalSize1=o.data.total,t.listData1=o.data.records,a&&a.awardAmount&&o.data.records.forEach(function(t,o){t.templateId===(a.awardAmount||a.award)&&(e.selectIndex1=o)})):t.$Message.error("获取数据失败")})},loadTableData2:function(){var t=this,e=this,a=this.volumeObj;this.totalSize2=0,this.listData2=[],this.TableLoading2=!0,this.selectIndex2="";var o={page:this.volumeForm.current2,size:10,cityCode:this.addressValue[1]||"",couponName:this.volumeForm.couponName,merchantName:this.volumeForm.merchantName,provinceCode:this.addressValue[0]||""};Object(n["g"])("/coupon/merchant/list?pageNum=".concat(this.current2,"&pageSize=10"),o).then(function(o){t.TableLoading2=!1,"200"===o.code?(t.totalSize2=o.data.total,t.listData2=o.data.records,a&&a.awardAmount&&o.data.records.forEach(function(t,o){t.templateId===(a.awardAmount||a.award)&&(e.selectIndex2=o)})):t.$Message.error("获取数据失败")})},handleSelect:function(t,e){this.selectDataList=t},changeCurrent1:function(t){this.volumeForm.current1!=t&&(this.volumeForm.current1=t,this.loadTableData1())},changeCurrent2:function(t){this.volumeForm.current2!=t&&(this.volumeForm.current2=t,this.loadTableData2())},selectBusiness:function(t){switch(t){case 1:this.selectIndex2="",this.volumeObj.JObj=this.listData1[this.selectIndex1],this.volumeObj.awardName=this.listData1[this.selectIndex1].title,this.volumeObj.couponType="1",this.volumeObj.awardAmount=this.listData1[this.selectIndex1].templateId;break;case 2:this.selectIndex1="",this.volumeObj.JObj=this.listData2[this.selectIndex2],this.volumeObj.awardName=this.listData2[this.selectIndex2].title,this.volumeObj.couponType="2",this.volumeObj.awardAmount=this.listData2[this.selectIndex2].templateId;break}},volumeClose:function(){this.$emit("setViewDialogVisible",!1)},volumeSave:function(){this.volumeObj.JObj||this.$Message.error({content:"请选择优惠券",duration:3}),this.$emit("setViewDialogVisible",this.volumeObj)}},created:function(){this.getProvinceList()}},l=s,r=a("6691"),c=Object(r["a"])(l,o,i,!1,null,"89d1ba12",null);e["default"]=c.exports},"5fc5":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Modal",{attrs:{width:"800",title:"优惠券选择",closable:!1,"mask-closable":!1,"footer-hide":""},model:{value:t.viewDialogVisible,callback:function(e){t.viewDialogVisible=e},expression:"viewDialogVisible"}},[a("div",[a("div",[a("Card",{staticStyle:{"margin-bottom":"2px"},attrs:{bordered:!1}},[a("Form",{ref:"copponForm",attrs:{"label-position":"right","label-width":80,model:t.copponForm,inline:""}},[a("FormItem",{staticStyle:{width:"45%"},attrs:{label:"商家名称",span:"24"}},[a("Input",{attrs:{placeholder:" 请填写商家名称",maxlength:20},model:{value:t.copponForm.merchantName,callback:function(e){t.$set(t.copponForm,"merchantName",e)},expression:"copponForm.merchantName"}})],1),a("FormItem",{staticStyle:{width:"50%"},attrs:{label:"省/市",span:"24"}},[a("Cascader",{attrs:{data:t.addressData,"load-data":t.addressLoad},model:{value:t.addressValue,callback:function(e){t.addressValue=e},expression:"addressValue"}})],1),a("FormItem",{staticStyle:{width:"25%"},attrs:{label:"优惠券名称",span:"24"}},[a("Input",{attrs:{placeholder:" 请填写优惠券名称",maxlength:20},model:{value:t.copponForm.couponName,callback:function(e){t.$set(t.copponForm,"couponName",e)},expression:"copponForm.couponName"}})],1),a("FormItem",{staticStyle:{float:"right"},attrs:{span:"24","label-width":1}},[a("Button",{staticClass:"submit",staticStyle:{"margin-right":"5px"},attrs:{type:"primary",icon:"ios-search"},on:{click:function(e){return t.search("searchForm")}}},[t._v("搜索")]),a("Button",{attrs:{icon:"md-refresh"},on:{click:t.reset}},[t._v("重置")])],1)],1)],1),a("Row",[a("Table",{ref:"table",attrs:{loading:t.TableLoading,border:"",columns:t.tableColumns,data:t.listData,sortable:"custom"},on:{"on-selection-change":t.handleSelect},scopedSlots:t._u([{key:"address",fn:function(e){var o=e.row;e.index;return[a("div",[t._v(t._s(o.province+"/"+o.city))])]}},{key:"timer",fn:function(e){var o=e.row;e.index;return[a("div",[t._v(t._s(o.useStartTime+" -- "+o.useEndTime))])]}}])})],1),a("Row",{staticClass:"page",attrs:{type:"flex",justify:"end"}},[a("Page",{staticStyle:{float:"right"},attrs:{total:t.totalSize,"show-total":"","show-elevator":"",current:t.current},on:{"on-change":t.changeCurrent,"update:current":function(e){t.current=e}}})],1)],1)]),a("div",{staticStyle:{"text-align":"center",margin:"10px 0"}},[a("Button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary"},on:{click:t.couponSave}},[t._v("保存")]),a("Button",{staticStyle:{"margin-left":"8px"},on:{click:t.couponClose}},[t._v("关闭")])],1)])},i=[],n=a("7f80"),s={name:"couponModal",props:{viewDialogVisible:{type:Boolean,default:!1}},data:function(){return{TableLoading:"",copponForm:{merchantName:"",couponName:"",current:1},totalSize:0,current:1,selectIndex:"",selectRow:{},addressData:[],addressValue:[],tableColumns:[{type:"selection",width:60,align:"center"},{title:"商家名称",minWidth:200,key:"merchantName",align:"center"},{title:"省/市",minWidth:200,slot:"address",align:"center"},{title:"优惠券名称",minWidth:200,key:"title",align:"center"},{title:"有效期",minWidth:200,slot:"timer",align:"center"}],listData:[],selectDataList:[]}},methods:{resetRow:function(t){this.copponForm.couponName="",this.copponForm.current=1,this.copponForm.merchantName="",this.addressValue=[],this.loadTableData(t),this.selectDataList=[]},getProvinceList:function(t){var e=this;Object(n["g"])("/system/area/province/list",{}).then(function(t){"200"===t.code?(console.log(t),e.addressData=t.data||[],e.addressData.length&&e.addressData.forEach(function(t){t.value=t.provinceCode,t.label=t.shortName,t.children=[],t.loading=!1})):e.$Message.error("获取数据失败")})},addressLoad:function(t,e){var a=this;t.loading=!0,Object(n["d"])("/system/area/city/"+t.provinceCode).then(function(o){"200"===o.code?(t.children=o.data||[],t.loading=!1,t.children.length&&t.children.forEach(function(t){t.label=t.shortName,t.value=t.cityCode}),e()):(a.$Message.error("获取数据失败"),t.loading=!1,e())})},search:function(){this.loadTableData()},reset:function(){this.copponForm.couponName="",this.copponForm.current=1,this.copponForm.merchantName="",this.addressValue=[]},loadTableData:function(t){var e=this;this.selectDataList=[],this.totalSize=0,this.listData=[],this.TableLoading=!0;var a={page:this.copponForm.current,size:10,cityCode:this.addressValue[1]||"",couponName:this.copponForm.couponName,merchantName:this.copponForm.merchantName,provinceCode:this.addressValue[0]||""};Object(n["g"])("/coupon/merchant/list",a).then(function(t){e.TableLoading=!1,"200"===t.code?(e.totalSize=t.data.total,e.listData=t.data.records||[]):e.$Message.error("获取数据失败")})},handleSelect:function(t,e){this.selectDataList=t},changeCurrent:function(t){this.copponForm.current!=t&&(this.copponForm.current=t,this.loadTableData())},couponClose:function(){this.$emit("setViewDialogVisible",!1)},couponSave:function(){0!=this.selectDataList.length?this.$emit("setViewDialogVisible",this.selectDataList):this.$Message.error("请选择")}},created:function(){this.getProvinceList()}},l=s,r=a("6691"),c=Object(r["a"])(l,o,i,!1,null,"64b1ea0d",null);e["default"]=c.exports},"661a":function(t,e,a){"use strict";var o=a("889c"),i=a.n(o);i.a},"889c":function(t,e,a){},"915a":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.viewDialogVisible?a("div",{staticClass:"modal",on:{click:function(t){t.stopPropagation()}}},[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("新增")]),a("a",{attrs:{slot:"extra",href:"#"},slot:"extra"},[a("Button",{attrs:{type:"dashed",icon:"md-arrow-round-back"},on:{click:function(e){return t.close()}}},[t._v("返回上一层")])],1),a("Form",{ref:"addOrEditModal",attrs:{model:t.modal,rules:t.ruleValidate,"label-width":80,"label-position":"left"}},[a("h3",[t._v("活动信息")]),a("Row",{staticClass:"padding-left-12"},[a("Col",{attrs:{span:"18"}},[a("FormItem",{attrs:{label:"活动名称:"}},[a("Input",{staticStyle:{width:"100%"},attrs:{type:"text",placeholder:"请填写活动名称，20字以内",maxlength:20},model:{value:t.modal.name,callback:function(e){t.$set(t.modal,"name",e)},expression:"modal.name"}})],1)],1)],1),a("Row",{staticClass:"padding-left-12"},[a("Col",{attrs:{span:"18"}},[a("FormItem",{attrs:{label:"活动时间:"}},[a("DatePicker",{staticStyle:{width:"160px"},attrs:{value:t.modal.startTime,type:"date",placeholder:"",options:t.options1},on:{"on-change":function(e){t.changeDateTime(e,1)}}}),a("div",{staticStyle:{width:"2%",display:"inline-block"}}),a("DatePicker",{staticStyle:{width:"160px"},attrs:{value:t.modal.endTime,type:"date",placeholder:"",options:t.options2},on:{"on-change":function(e){t.changeDateTime(e,2)}}})],1)],1)],1),a("h3",[t._v("请选择参与活动券")]),a("Row",{staticClass:"padding-left-12"},[a("Col",{attrs:{span:"18"}},[a("FormItem",{attrs:{label:"参与活动券:"}},[a("Button",{attrs:{type:"dashed"},on:{click:t.openCoupon}},[0===t.couponObj.length?a("span",[t._v("参与活动券")]):t._e(),t._l(t.couponObj,function(e,o){return a("Button",{staticClass:"coupon-item"},[t._v("\n                            "+t._s(e.title+"  ")+"\n                            "),a("Icon",{attrs:{type:"ios-close"},on:{click:function(e){return t.reMoveCoupon(o)}}})],1)})],2)],1)],1)],1),a("h3",[t._v("赠送规则")]),a("Row",{staticClass:"padding-left-12"},[a("Col",{attrs:{span:"24"}},[a("RadioGroup",{staticStyle:{width:"100%"},attrs:{vertical:"","on-change":t.changeRadio},model:{value:t.modal.wardType,callback:function(e){t.$set(t.modal,"wardType",e)},expression:"modal.wardType"}},[a("Radio",{staticStyle:{display:"inline-block"},attrs:{label:"1"}},[a("span",[t._v("核销赠券")])]),a("div",{staticStyle:{width:"2%",display:"inline-block"}}),a("span",{staticClass:"colof-a2"},[t._v("(在核销商户券码时，赠送优惠券至店员卡包，前提店员是要优惠C端用户)")]),a("div",{staticStyle:{width:"2%",display:"inline-block"}}),a("Button",{staticStyle:{float:"right"},attrs:{type:"primary",icon:"md-add"},on:{click:t.addJList}},[t._v("新增")]),t._l(t.JawardRuleDtos,function(e,o){return a("div",{staticClass:"radio-item"},[a("div",[a("span",[t._v("每日核销范围在 ")]),a("InputNumber",{attrs:{min:1,step:1,type:"text",precision:0,placeholder:"请输入数值"},model:{value:e.verifyCountMin,callback:function(a){t.$set(e,"verifyCountMin",a)},expression:"item.verifyCountMin"}}),a("div",{staticStyle:{width:"2%",display:"inline-block"}}),a("InputNumber",{attrs:{min:1,step:1,type:"text",precision:0,placeholder:"请输入数值"},model:{value:e.verifyCountMax,callback:function(a){t.$set(e,"verifyCountMax",a)},expression:"item.verifyCountMax"}}),a("span",[t._v(" 张时，赠送以下优惠券")]),a("div",{staticStyle:{width:"2%",display:"inline-block"}}),a("span",{staticClass:"colof-a2"},[t._v("(后面文本框的数值不填写，表示无限大)")])],1),a("div",{staticStyle:{margin:"10px 0"}},[a("Button",{attrs:{type:"dashed"},on:{click:function(a){return t.openVolume(e)}}},[t._v(t._s(e.awardName||e.title?e.awardName||e.title:"请选择优惠券"))])],1),a("div",{staticClass:"reduce-btn"},[t.JawardRuleDtos.length>1?a("Button",{attrs:{type:"error",shape:"circle",icon:"ios-trash"},on:{click:function(e){return t.reduce(t.JawardRuleDtos,o)}}}):t._e()],1)])}),a("Radio",{staticStyle:{display:"inline-block"},attrs:{label:"2"}},[a("span",[t._v("核销赠U贝")])]),a("div",{staticStyle:{width:"2%",display:"inline-block"}}),a("span",{staticClass:"colof-a2"},[t._v("(在核销主商户券码时，赠送平台U贝，前提店员是要优惠C端用户)")]),a("div",{staticStyle:{width:"2%",display:"inline-block"}}),a("Button",{staticStyle:{float:"right"},attrs:{type:"primary",icon:"md-add"},on:{click:t.addUList}},[t._v("新增")]),t._l(t.UawardRuleDtos,function(e,o){return a("div",{staticClass:"radio-item"},[a("span",[t._v("每日核销范围在 ")]),a("InputNumber",{attrs:{min:0,step:1,type:"text",precision:0,placeholder:"请输入数值"},model:{value:e.verifyCountMin,callback:function(a){t.$set(e,"verifyCountMin",a)},expression:"item.verifyCountMin"}}),a("div",{staticStyle:{width:"2%",display:"inline-block"}}),a("InputNumber",{attrs:{min:1,step:1,type:"text",precision:0,placeholder:"请输入数值"},model:{value:e.verifyCountMax,callback:function(a){t.$set(e,"verifyCountMax",a)},expression:"item.verifyCountMax"}}),a("span",[t._v(" 张时，赠送以下U贝")]),a("span",{staticClass:"colof-a2"},[t._v("(后面文本框的数值不填写，表示无限大)")]),a("div",{staticStyle:{margin:"10px 0"}},[a("InputNumber",{staticStyle:{width:"150px"},attrs:{min:0,step:1,type:"text",precision:0,placeholder:"请输入U贝数量"},model:{value:e.awardAmount,callback:function(a){t.$set(e,"awardAmount",a)},expression:"item.awardAmount"}})],1),a("div",{staticClass:"reduce-btn"},[t.UawardRuleDtos.length>1?a("Button",{attrs:{type:"error",shape:"circle",icon:"ios-trash"},on:{click:function(e){return t.reduce(t.UawardRuleDtos,o)}}}):t._e()],1)],1)})],2)],1)],1),a("FormItem",[a("Button",{staticStyle:{margin:"20px"},attrs:{type:"primary",size:"large"},on:{click:function(e){return t.ok()}}},[t._v("保存")]),a("Button",{staticStyle:{margin:"20px"},on:{click:t.close}},[t._v("返回")])],1)],1)],1),a("volumeModal",{ref:"volumeModal",attrs:{viewDialogVisible:t.selectActiveVolumeModal},on:{setViewDialogVisible:t.selectVolume}}),a("couponModal",{ref:"couponModal",attrs:{viewDialogVisible:t.couponViewDialogModal},on:{setViewDialogVisible:t.selectCoupon}})],1):t._e()},i=[],n=a("7f80"),s=a("2e1e"),l=a("5fc5");function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var c={name:"add-or-edit-modal",components:{volumeModal:s["default"],couponModal:l["default"]},props:{viewDialogVisible:{type:Boolean,default:!1}},data:function(){return{titleName:"",selectActiveVolumeModal:!1,selectActiveVolumeObj:{},couponViewDialogModal:!1,couponObj:[],modal:{name:"",startTime:"",endTime:"",awardType:"1",type:"1"},options2:{disabledDate:function(t){return t.valueOf()<Date.now()-864e5}},options1:{disabledDate:function(t){return t.valueOf()<Date.now()-864e5}},JawardRuleDtos:[{verifyCountMin:null,verifyCountMax:null,awardAmount:null,awardType:"1",couponType:"",awardName:""}],UawardRuleDtos:[{verifyCountMin:null,verifyCountMax:null,awardAmount:null,awardType:"2",couponType:"",awardName:""}],ruleValidate:{}}},methods:{numArrayValidator:function(t){for(var e=!0,a=t.sort(function(t,e){return t.min-e.min}),o=0;o<a.length-1;o++){if(a[o].verifyCountMax<=a[o].verifyCountMin){this.$Message.error({content:"最小值不能大于等于最大值",duration:3}),e=!1;break}if(a[o].verifyCountMax>=a[o+1].verifyCountMin){this.$Message.error({content:"请输入正确区间数值",duration:3}),e=!1;break}}return e},changeDateTime:function(t,e){switch(e){case 1:this.modal.startTime=t,this.options2={disabledDate:function(e){return e.valueOf()<new Date(t)-864e5}};break;case 2:this.modal.endTime=t,this.options1={disabledDate:function(e){return e.valueOf()<Date.now()-864e5||e.valueOf()>new Date(t)}};break}},changeRadio:function(){},resetRow:function(t){var e=this;this.options2={disabledDate:function(t){return t.valueOf()<Date.now()-864e5}},this.options1={disabledDate:function(t){return t.valueOf()<Date.now()-864e5}},t?(this.titleName="编辑",this.modal.id=t.id,Object(n["c"])("/merchant/activity/award/activity/".concat(t.id)).then(function(t){if("200"===t.code){var a=t.data;e.modal.name=a.name,e.modal.startTime=a.startTime,e.modal.wardType=a.awardType.toString(),e.modal.endTime=a.endTime,e.modal.type="2",e.couponObj=a.coupons,e.modal.status=a.status,a.awardRuleVos&&a.awardRuleVos.length&&a.awardRuleVos.forEach(function(t,e){t.awardAmount=t.award}),"1"==a.awardType?(e.JawardRuleDtos=a.awardRuleVos,e.JawardRuleDtos.forEach(function(t,e){t.verifyCountMax||(t.verifyCountMax=null),t.verifyCountMin||(t.verifyCountMin=null)}),e.UawardRuleDtos=[{verifyCountMin:null,verifyCountMax:null,awardAmount:null,awardType:"1",couponType:"",awardName:""}]):"2"==a.awardType&&(e.UawardRuleDtos=a.awardRuleVos,e.UawardRuleDtos.forEach(function(t,e){t.verifyCountMax||(t.verifyCountMax=null),t.verifyCountMin||(t.verifyCountMin=null)}),e.JawardRuleDtos=[{verifyCountMin:null,verifyCountMax:null,awardAmount:null,awardType:"2",couponType:"",awardName:""}])}else e.$Message.error(t.msg)})):(this.titleName="新增",this.modal.name="",this.modal.startTime="",this.modal.wardType="1",this.modal.endTime="",this.modal.type="1",this.couponObj=[],this.JawardRuleDtos=[{verifyCountMin:null,verifyCountMax:null,awardAmount:null,awardType:"1",couponType:"",awardName:""}],this.UawardRuleDtos=[{verifyCountMin:null,verifyCountMax:null,awardAmount:null,awardType:"2",couponType:"",awardName:""}])},openCoupon:function(){var t=this;this.couponViewDialogModal=!0,this.$nextTick(function(){t.$refs["couponModal"].resetRow(t.couponObj)})},selectCoupon:function(t){if(this.couponViewDialogModal=!1,t){var e=this;t.forEach(function(a,o){e.couponObj.forEach(function(e,i){a.templateId===(e.templateId||e.id)&&t.splice(o,1)})}),this.couponObj=this.couponObj.concat(t)}},openVolume:function(t){var e=this;this.selectActiveVolumeModal=!0,this.$nextTick(function(){e.$refs["volumeModal"].resetRow(t)})},selectVolume:function(){this.selectActiveVolumeModal=!1},addJList:function(){this.JawardRuleDtos.push({verifyCountMin:null,verifyCountMax:null,awardAmount:null,awardType:"1",couponType:"",awardName:""})},addUList:function(){this.UawardRuleDtos.push({verifyCountMin:null,verifyCountMax:null,awardAmount:null,awardType:"2",couponType:"",awardName:""})},reduce:function(t,e){t.splice(e,1)},reMoveCoupon:function(t){this.couponObj.splice(t,1)},ok:function(){var t=this,e=r({endTime:this.modal.endTime,id:this.modal.id,name:this.modal.name,startTime:this.modal.startTime,type:this.modal.type,wardType:this.modal.wardType},"type",2),a=[];if(this.couponObj&&this.couponObj.length)if(this.couponObj.forEach(function(t,e){a.push(t.templateId||t.id)}),e.couponIds=a,this.modal.name)if(this.modal.startTime&&this.modal.endTime)if(this.modal.wardType){"1"==this.modal.wardType?e.awardRuleDtos=this.JawardRuleDtos:"2"==this.modal.wardType&&(e.awardRuleDtos=this.UawardRuleDtos);var o="";"1"==this.modal.wardType?(e.awardRuleDtos=this.JawardRuleDtos,e.awardRuleDtos.forEach(function(t,e){t.awardAmount||(o="请选择优惠卷")})):"2"==this.modal.wardType&&(e.awardRuleDtos=this.UawardRuleDtos,e.awardRuleDtos.forEach(function(t,e){t.awardAmount&&0!=t.awardAmount||(o="请填写大于0的U贝数量")})),o?this.$Message.error(o):this.numArrayValidator(e.awardRuleDtos)&&("新增"==this.titleName?Object(n["g"])("/merchant/activity/award/add/activity",e).then(function(e){"200"===e.code?(t.$Message.success("新增成功"),t.$emit("setViewDialogVisible",!1),t.$emit("search")):t.$Message.error(e.msg)}):Object(n["g"])("/merchant/activity/award/update/activity",e).then(function(e){"200"===e.code?(t.$Message.success("编辑成功"),t.$emit("setViewDialogVisible",!1),t.$emit("search")):t.$Message.error(e.msg)}))}else this.$Message.error("请选择赠送类型");else this.$Message.error("请选择时间");else this.$Message.error("请填写活动名称");else this.$Message.error("请选择优惠卷")},close:function(){this.$emit("setViewDialogVisible",!1)}}},d=c,u=(a("661a"),a("6691")),m=Object(u["a"])(d,o,i,!1,null,"9d651c80",null);e["default"]=m.exports}}]);